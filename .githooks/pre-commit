git diff --cached --name-status | while read st file; do
	#
	# Skip deleted files
	# 
	if [ "$st" == 'D' ]; then continue; fi

	#
	# Path to the repository
	#
	dirpath=$(git rev-parse --show-toplevel)

	go run $dirpath/.githooks/pre-commit.go $file

	if [[ $? -ne 0 ]]; then
		echo "Security check failed"
		git diff $file
		exit 1
	fi
done